version: 2.1
orbs:
  python: circleci/python@2.1.1

commands:
  install-project:
    steps:
      - checkout
      - python/install-packages:
          pkg-manager: pip
      - run:
          name: Install dev dependencies
          command: pip install pytest pytest-cov black ruff mypy

jobs:
  lint:
    executor:
      name: python/default
      tag: "3.12"
    steps:
      - install-project
      - run:
          name: Run ruff linting
          command: ruff check src tests
      - run:
          name: Check code formatting with black
          command: black --check src tests

  type-check:
    executor:
      name: python/default
      tag: "3.12"
    steps:
      - install-project
      - run:
          name: Run mypy type checking
          command: mypy src

  test:
    executor:
      name: python/default
      tag: "3.12"
    steps:
      - install-project
      - run:
          name: Run tests with coverage
          command: pytest --cov=src --cov-report=term-missing --cov-report=xml
      - store_artifacts:
          path: coverage.xml
          destination: coverage

workflows:
  version: 2
  ci:
    jobs:
      - lint
      - type-check
      - test
